name: Load Server Dataset
description: Automatically loads the dataset from the server machine, processes it, and saves it as a PyTorch .pt file for downstream tasks.

outputs:
  - name: outputpath1
    type: String
    description: Path to the saved dataset file (.pt)

implementation:
  container:
    image: python:3.9
    command:
      - sh
      - -c
      - |
        set -e
        # Install dependencies
        PIP_DISABLE_PIP_VERSION_CHECK=1 python3 -m pip install --quiet torch torchvision torchaudio pandas --user

        # Run Python script
        python3 -u - <<'PYCODE'
        import os
        import torch
        import sys
        from my_dataset_module import load_dataset  # Replace with your actual dataset loader

        OUTPUT_PATH = sys.argv[1]

        DATA_PATH = "/mnt/data/server_dataset/train.csv"  # Change to the actual location
        BATCH_SIZE = 32
        DEVICE = "cuda:0"
        SCALING_REQUIRED = True

        print(f"[INFO] Loading dataset from server path: {DATA_PATH}")
        dataloader = load_dataset(DATA_PATH, BATCH_SIZE, BATCH_SIZE, BATCH_SIZE, SCALING_REQUIRED)
        scaler = dataloader['scaler']

        os.makedirs(os.path.dirname(OUTPUT_PATH), exist_ok=True)
        torch.save({'dataloader': dataloader, 'scaler': scaler}, OUTPUT_PATH)
        print(f"[SUCCESS] Dataset saved to {OUTPUT_PATH}")
        PYCODE
    args:
      - --outputpath1
      - {outputPath: outputpath1}
